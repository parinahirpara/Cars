@page "/car"
@model Cars.Pages.Car.IndexModel
@{
    ViewData["Title"] = "Cars";
}

<h1>Cars</h1>

<p>
    <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCarModal">Add Car</a>
</p>

<table id="carsTable"></table>

<table class="table">
    <thead>
        <tr>
            <th>Brand</th>
            <th>Model</th>
            <th>Year</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var car in Model.Cars)
        {
            <tr>
                <td>@car.Brand</td>
                <td>@car.Model</td>
                <td>@car.Year</td>
                <td>@car.Price</td>
                <td>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#editCarModal_@car.Id">Edit</button>
                        <form asp-page-handler="Delete" asp-route-id="@car.Id" method="post" onsubmit="return confirm('Are you sure you want to delete this car?');">
                            <button class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                   
                </td>
            </tr>

            <div class="modal fade" id="editCarModal_@car.Id" tabindex="-1" aria-labelledby="editCarModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form method="post" asp-page-handler="EditCar">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editCarModalLabel">Edit Car</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="Id" value="@car.Id">
                                <div class="mb-3">
                                    <label for="brandInput_@car.Id" class="form-label">Brand:</label>
                                    <input type="text" class="form-control" id="brandInput_@car.Id" name="Brand" value="@car.Brand" required>
                                </div>
                                <div class="mb-3">
                                    <label for="modelInput_@car.Id" class="form-label">Model:</label>
                                    <input type="text" class="form-control" id="modelInput_@car.Id" name="Model" value="@car.Model" required>
                                </div>
                                <div class="mb-3">
                                    <label for="yearInput_@car.Id" class="form-label">Year:</label>
                                    <input type="number" class="form-control" id="yearInput_@car.Id" name="Year" value="@car.Year" required>
                                </div>
                                <div class="mb-3">
                                    <label for="priceInput_@car.Id" class="form-label">Price:</label>
                                    <input type="number" step="0.01" class="form-control" id="priceInput_@car.Id" name="Price" value="@car.Price" required>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="newInput_@car.Id" name="New" @if (car.New)
                                    {
                                        <text>checked</text>
                                    }>
                                    <label class="form-check-label" for="newInput_@car.Id">New</label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        }
    </tbody>
</table>

<div class="modal fade" id="addCarModal" tabindex="-1" aria-labelledby="addCarModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="AddCar">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCarModalLabel">Add New Car</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="brandInput" class="form-label">Brand:</label>
                        <input type="text" class="form-control" id="brandInput" name="Brand" required>
                    </div>
                    <div class="mb-3">
                        <label for="modelInput" class="form-label">Model:</label>
                        <input type="text" class="form-control" id="modelInput" name="Model" required>
                    </div>
                    <div class="mb-3">
                        <label for="yearInput" class="form-label">Year:</label>
                        <input type="number" class="form-control" id="yearInput" name="Year" required>
                    </div>
                    <div class="mb-3">
                        <label for="priceInput" class="form-label">Price:</label>
                        <input type="number" step="0.01" class="form-control" id="priceInput" name="Price" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="newInput" name="New">
                        <label class="form-check-label" for="newInput">New</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Car</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
        // $(document).ready(function () {
        //     var tableConfig = {
        //         order: [[1, 'asc']],
        //         "dom": '<"top"lf>rt<"bottom"ip><"clear">',
        //         serverSide: true,
        //         processing: true,
        //         responsive: true,
        //         searching: true,
        //         ordering: true,
        //         select: false,
        //         sortable: true,
        //         destroy: true,
        //         aaSorting: [],
        //         ajax: {
        //             url: '@Url.Action("CarDatatableResult", "Cars")',
        //             method: 'Post',
        //             contentType: "multipart/form-data",
        //             dataSrc: function (jsonData) {
        //                 return ResolveJsonReferences(jsonData);
        //             },
        //             data: function (d) {

        //             }

        //         },
        //         columns: [
        //             { data: 'brand', title: 'Brand' },
        //             { data: 'model', title: 'Model' },
        //             { data: 'year', title: 'Year' },
        //             { data: 'new', title: 'New' }
        //             // Add columns configurations for other fields
        //         ],
        //         lengthMenu: [[5, 10, 20, 50, 400, -1], [5, 10, 20, 50, 400, "All"]],
        //         pageLength: 5,
        //         columnDefs: [{
        //             "defaultContent": "-",
        //             "targets": "_all"
        //         }],

        //     };
        //     $.fn.dataTable.ext.errMode = 'none';
        //     dynamicTable = $('#carsTable').on('error.dt', function (e, settings, techNote, message) {
        //     }).DataTable(tableConfig);
        //     $('#carsTable').wrap('<div class="table-responsive">');
        //     $(".table-responsive").css("position", "relative");

           
           
        // });
    </script>
}

